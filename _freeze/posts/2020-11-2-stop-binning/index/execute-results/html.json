{
  "hash": "9fab87731ffa2532127036df093ff605",
  "result": {
    "markdown": "---\ntitle: Treat your treatments as continuous\nauthor: Eric R. Scott\ndate: '2020-11-02'\n# slug: stop-binning\ncategories:\n  - r\n  - quadratic-regression\n  - modeling\nimage: featured.png\nimage-alt: \"Left: A plot titled 'ANOVA' showing a bar chart with three bars.  x-axis reads 'Fertilizer (kg N/ha)'.  y-axis reads '%maximum yield'.  The three bars have significance letters indicating that the highest fertilizer treatment has significantly lower yield.  Right: a plot titled 'Regression' where a quadratic line is plotted through points with a confidence interval ribbon.  The x-axis on this plot reads 'Soil N (kg N/ha)' \"\n---\n\n{{< downloadthis index.Rmd dname=\"index.Rmd\" label=\"Download Rmd\">}}\n\n\n\n\n\n\n\nTaking a potentially continuous treatment, binning it into categories, and doing ANOVA results in reduced statistical power and complicated interpretation.\nYet, as a graduate student, I was advised to bin continuous treatment variables into categories multiple times by different people.\nWhy?\nI suspect it's because ANOVA is what ecologists are most familiar with, and the alternative, a quadratic regression, *sounds* complicated.\nA regression also doesn't let you draw a bar plot with letters over the bars that ecologists really seem to love.\nHopefully this example with simulated data will convince you to consider regression over ANOVA[^1] when your treatment can be considered continuous (and you suspect a continuous relationship with the response).\n\nI'll work through an example with simulated data to show you what I mean.\nLet's say you've applied fertilizer at 3 different levels to 15 replicate corn fields (5 fields per fertilizer treatment).\nThe treatments are 100, 200, and 300 kg N / ha.\nWe measure yield and standardize it to percent of maximum yield.\n\nI'm going to analyze this both as an ANOVA type design, treating fertilizer as categorical, and as a regression.\nFor the sake of demonstration, I'll use post-hoc power analysis to get statistical power for each test (something you [probably shouldn't do](https://www.r-bloggers.com/2020/01/playing-with-post-hoc-power-with-r-why-we-shouldnt-do-it/) in practice because post-hoc power is fixed once you compute a p-value).\n\n# ANOVA\n\nHere's the ANOVA model in R:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- aov(yield ~ fert_factor, data = df)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: yield\n            Df Sum Sq Mean Sq F value  Pr(>F)  \nfert_factor  2 333.19 166.595  5.0086 0.02621 *\nResiduals   12 399.14  33.262                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\n\nAccording to the ANOVA, there is a significant effect of fertilizer on yield (p = 0.026)\n\nOur results look like this:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nOur sample size, $n$, is 5.\nStatistical power, $\\beta$, is 0.39.[^2]\n\n# Regression\n\nBut why not treat those concentrations as a continuous variable and instead fit a quadratic regression?\nA quadratic regression fits a line described by a quadratic function (a curve) through the relationship between fertilizer concentration and growth.\nHere's what this model looks like:\n\n$$\nyield = \\beta_0 + \\beta_1fert +  \\beta_2fert^2\n$$\n\nThis method is flexible.\nThe relationship could be concave, convex, or increasing with a varying slope.\nIf the true relationship is linear, then $\\beta_2$ will be zero, and we'll be left with the equation for a line.\n\nThere are two ways to write this model as R code.\nThis first form is useful because the default behavior of `anova()` gives a single p-value for the effect of fertilizer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1a <- lm(yield ~ poly(fert, 2, raw = TRUE), data = df)\nanova(m1a)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: yield\n                          Df Sum Sq Mean Sq F value  Pr(>F)  \npoly(fert, 2, raw = TRUE)  2 333.19 166.595  5.0086 0.02621 *\nResiduals                 12 399.14  33.262                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nThis second form is useful because it tells you if the quadratic term is significant (if it's not, you might try just fitting a straight line).\n`I()` means \"literally multiply, don't fit an interaction term\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1b <- lm(yield ~ fert + I(fert * fert), data = df)\nanova(m1b)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: yield\n               Df Sum Sq Mean Sq F value  Pr(>F)  \nfert            1 141.80 141.805  4.2633 0.06125 .\nI(fert * fert)  1 191.39 191.385  5.7539 0.03360 *\nResiduals      12 399.14  33.262                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nEither way, there is still a significant effect of fertilizer on yield.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\nNow $n = 15$, and our power, $\\beta$, has gone up to 0.8.\nThe power is doubled compared to the ANOVA design because of the greater effective sample size in the regression model.\n\n# Better yet, measure the treatment\n\nBut wait, there's more!\nI haven't told you something about the data I simulated.\nI generated data so that growth has a quadratic response to nitrogen concentration **in the soil**, but soil nitrogen isn't perfectly correlated with the nitrogen applied.\nYour intended treatment is rarely what a plant is actually experiencing.\nSo let's say we can do even better than including the *intended* treatment as a continuous variable---let's get the soil tested for nitrogen content and use **that** as an independent variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- lm(yield ~ true + I(true * true), data = df)\nanova(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Variance Table\n\nResponse: yield\n               Df Sum Sq Mean Sq F value   Pr(>F)   \ntrue            1 219.48 219.479  10.186 0.007754 **\nI(true * true)  1 254.28 254.278  11.801 0.004938 **\nResiduals      12 258.57  21.548                    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\nNow our power, $\\beta$, is 0.99.\nIt's probably very often worth it to try to measure whatever latent variable that mediates the effect of your treatment.\nIn fact, that increased spread of your data is a *good thing* if you want to better describe the shape of the relationship between treatment and response.\n\n\n::: {.cell}\n\n:::\n\n\n[^1]: Well, technically [ANOVA *is* a regression](https://lindeloev.github.io/tests-as-linear/#61_one-way_anova_and_kruskal-wallis)\n\n[^2]: Statistical power was estimated using the `pwr` package.\n    Effect size was calculated using [Cohen's suggestions](https://www.statmethods.net/stats/power.html).\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}