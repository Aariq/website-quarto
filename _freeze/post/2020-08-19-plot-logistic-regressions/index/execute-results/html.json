{
  "hash": "e83003129563361425c6e08b1cfee9d1",
  "result": {
    "markdown": "---\ntitle: Three ways to plot logistic regressions\nauthor: Eric R. Scott\ndate: '2020-08-19'\n# slug: plot-logistic-regressions\ncategories:\n  - r\n  - data-visualization\n---\n\n\n\n\nIf your data is just 1's and 0's, it can be difficult to visualize alongside a best-fit line from a logistic regression.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nEven with transparency, the overplotted data points just turn into a smear on the top and bottom of your plot, adding little information.\nHere are three ways to get more information out of those points and produce more informative plots.\nBut first, a quick introduction to the data.\n\n## The data\n\nI simulated some data on survival as a function of size.\nSurvival is binary (1 = survived, 0 = died).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n   size  surv\n  <dbl> <int>\n1  4.78     0\n2  4.40     1\n3  5.02     1\n4  5.32     1\n5  4.61     0\n6  4.81     1\n```\n:::\n\n```{.r .cell-code}\nnrow(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1000\n```\n:::\n:::\n\n\nWe can fit a logistic regression...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- glm(surv ~ size, family = binomial, data = df)\n```\n:::\n\n\n...and extract fitted values using `broom::augment()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_df <- augment(m, type.predict = \"response\")\nhead(plot_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n   surv  size .fitted .resid .std.resid    .hat .sigma  .cooksd\n  <int> <dbl>   <dbl>  <dbl>      <dbl>   <dbl>  <dbl>    <dbl>\n1     0  4.78   0.746 -1.66      -1.66  0.00125  0.970 0.00184 \n2     1  4.40   0.601  1.01       1.01  0.00287  0.971 0.000958\n3     1  5.02   0.819  0.633      0.633 0.00122  0.972 0.000136\n4     1  5.32   0.884  0.496      0.496 0.00160  0.972 0.000105\n5     0  4.61   0.685 -1.52      -1.52  0.00169  0.971 0.00184 \n6     1  4.81   0.756  0.748      0.748 0.00122  0.971 0.000197\n```\n:::\n:::\n\n\nThese are the data I used for the plot above with the points corresponding to `surv` and the best-fit line corresponding to `.fitted`\n\n``` r\nbase <-\n  ggplot(plotdf, aes(x = size)) +\n  geom_line(aes(y = .fitted), color = \"blue\") +\n  labs(x = \"Size\", y = \"Survival\")\n\nbase + geom_point(aes(y = surv), alpha = 0.2)\n```\n\n## 1. Rug plot\n\nTurning those points into a \"rug\" is a common way of dealing with overplotting in logistic regression plots.\n`ggplot2` provides `geom_rug()`, but getting that rug to correspond to dead plants on the bottom and live plants on the top requires a little data manipulation.\nFirst, we'll create separate columns for dead and alive plants where the values of size only if the plant is dead or alive, respectively, and otherwise `NA`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_df <-\n  plot_df %>% \n  mutate(survived = ifelse(surv == 1, size, NA),\n         died     = ifelse(surv == 0, size, NA))\n```\n:::\n\n\nThen, we can plot these as separate layers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase <-\n  ggplot(plot_df, aes(x = size)) +\n  geom_line(aes(y = .fitted), color = \"blue\") +\n  labs(x = \"Size\", y = \"Survival\")\n\nbase + \n  geom_rug(aes(x = died), sides = \"b\", alpha = 0.2) +\n  geom_rug(aes(x = survived), sides = \"t\", alpha = 0.2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nHonestly, this is not a huge improvment.\nThe overplotting is less of an issue and you can start to see the density of points a bit better, but it's still not great.\n\n## 2. Binned points\n\nI discovered this plot in [Data-driven Modeling of Structured Populations](https://www.springer.com/gp/book/9783319288918) by Ellner, Childs, and Rees.\nTheir plot used base R graphics, but I'll use `ggplot2` and `stat_summary_bin()` to get a mean survival value for binned size classes and plot those as points.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase + stat_summary_bin(geom = \"point\", fun = mean, aes(y = surv))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nI think this is fabulous!\nIt definitely needs an explanation in a figure caption though, because what those points represent is not immediately obvious.\nAlso, how close the points fit to the line has more to do with bin size than with model fit, so this one might be better for inspecting patterns than for evaluating fit.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase + stat_summary_bin(geom = \"point\", fun = mean, aes(y = surv)) + labs(title = \"bins = 30\") |\nbase + stat_summary_bin(geom = \"point\", fun = mean, aes(y = surv), bins = 60) + labs(title = \"bins = 60\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## 3. Histograms\n\nThis option takes the ideas of binning values from #2 and showing distributions in the margins from #1 and combines them.\nI discovered this in a [paper](http://brunalab.org/wp-content/uploads/2012/12/Bruna_etal_2014_Ecology.pdf) from my postdoc adviser, Emilio Bruna.\n\nA function to make this third type of plot with base R graphics is available in the `popbio` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(popbio)\nlogi.hist.plot(size, surv, boxp = FALSE, type = \"hist\", col = \"gray\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nRe-creating this with ggplot2 requires some hacks, and I'm still not all the way there.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase +\n  geom_histogram(aes(x = died, y = stat(count)/1000), bins = 30, na.rm = TRUE) +\n  geom_histogram(aes(x = survived, y = -1*stat(count/1000)), bins = 30, na.rm = TRUE, position = position_nudge(y = 1))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `stat(count)` was deprecated in ggplot2 3.4.0.\nℹ Please use `after_stat(count)` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nThere are at least two \"hacks\" going on here.\nFirst, I'm using `stat()` to extract the bar heights automatically calculated by `stat_bin()`/`geom_histogram()` to scale the histogram down.\nSecond, to get the histogram for survivors to be at the top I need to flip it upside down (by multiplying by -1) and move it to the top of the plot with `position_nudge()`.\nThe downside to this plot is that there are technically ***three*** y-axes---the survival probability and the number or proportion in each size class for dead and alive individuals (with 0 at the bottom and top, respectively).\nYou can [add a second y-axis to a ggplot](https://www.r-graph-gallery.com/line-chart-dual-Y-axis-ggplot2.html), but I'm not sure about a third y-axis.\n\nIf you know of another cool way to visualize logistic regressions, or know of some package that does all this for you, please let me know in the comments!\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}