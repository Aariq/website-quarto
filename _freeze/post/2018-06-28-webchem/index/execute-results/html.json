{
  "hash": "360073b2fcb083f6f52ec591c52359e5",
  "result": {
    "markdown": "---\ntitle: Retrieve chemical retention indices from NIST with {webchem}!\nauthor: Eric R. Scott\ndate: '2018-06-28'\n# slug: webchem\ncategories:\n  - data-science\n  - research\n  - data-wrangling\n  - r\n  - webscraping\n  - GC/MS\n# projects:\n#   - webchem\n---\n\n\n\n\nMy PhD has involved learning a lot more than I expected about analytical chemistry, and as I've been learning, I've been trying my best to make my life easier by writing R functions to help me out.\nSome of those functions have found a loving home in the `webchem` package, part of [rOpenSci](https://ropensci.org/).\n\nPapers that use gas chromatography to separate and measure chemicals often include a table of the compounds they found along with experimental retention indices and literature retention indices.\nA retention index is basically a corrected retention time---the time it took for the particular chemical to make it through the gas chromatograph, an instrument designed to separate chemicals, to the detector used to identify the compound (e.g. an FID or mass spectrometer).\nWhile the retention time for a particular compound might vary from run to run or beetween labs, the retention **index** should be comparable.\nTherefore, they are often used to help identify compounds and [NIST](https://webbook.nist.gov/chemistry/) maintains a database of retention indeces for researchers to refer to.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![An example table including literature retention indices from [Kowalsick, et al. 2014](https://doi.org/10.1016/j.chroma.2014.10.058)](kowalsick table.png){width=794}\n:::\n:::\n\n\nProducing such a table of literature retention indices for potentially hundreds of metabolites by hand can be really tedious!\n\nEnter `nist_ri()`, a handy function I wrote to scrape retention index tables from NIST.\nBelow, I work through an example of how you might use it.\nFirst, you need to install the latest version of `webchem`.\nMy function isn't in the latest CRAN release at the time of writing this blog post, but you can install from github like so:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::install_github(\"ropensci/webchem\")\n```\n:::\n\n\nTo look up a retention index, you need a CAS identifier number for the chemical (For now, at least. Other search methods may be implemented in the future).\nIf you don't already have CAS numbers, you can get them using other functions in `webchem` from chemical names or other identifier numbers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCASs <- c(\"83-34-1\", \"119-36-8\", \"123-35-3\", \"19700-21-1\")\n```\n:::\n\n\nLoad the package and take a look at the help file.\nYou'll see that we need to choose what type of retention index to scrape, what polarity of column, and what kind of teperature program.\nIf you browse one of the [NIST sites for a compound](https://webbook.nist.gov/cgi/cbook.cgi?ID=C78706&Units=SI&Mask=2000#Gas-Chrom), this will make more sense.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(webchem)\n?nist_ri\n```\n:::\n\n\nLet's get Van Den Dool & Kratz (AKA \"linear\") retention indexes for non-polar columns using a temperature ramp.\nThis might take a while, depending on your internet connection and how many CAS numbers you request data for.\nIf a certain type of retention index doesn't exist for a compound, the function will return `NA` for all columns but the CAS number.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRIs <-\n  nist_ri(\n    query = CASs,\n    from = \"cas\",\n    type = \"linear\",\n    polarity = \"non-polar\",\n    temp_prog = \"ramp\"\n  )\nhead(RIs)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 16\n  query      RI type  phase length gas   subst…¹ diame…² thick…³ temp_…⁴ temp_…⁵\n  <chr>   <dbl> <chr> <chr>  <dbl> <chr> <chr>     <dbl>   <dbl>   <dbl>   <dbl>\n1 83-34-1  1410 Capi… SPB-5     60 <NA>  <NA>       0.32    1         40     230\n2 83-34-1  1380 Capi… DB-5…     30 Heli… <NA>       0.25    0.25      35     225\n3 83-34-1  1410 Capi… SE-54     50 Heli… <NA>       0.32   NA         40     240\n4 83-34-1  1381 Capi… DB-5      30 Hydr… <NA>       0.25    0.25      35     270\n5 83-34-1  1389 Capi… DB-5      30 Nitr… <NA>       0.25    0.25      30     250\n6 83-34-1  1399 Capi… DB-5…     30 <NA>  <NA>       0.25    0.25      40     200\n# … with 5 more variables: temp_rate <dbl>, hold_start <dbl>, hold_end <dbl>,\n#   reference <chr>, comment <chr>, and abbreviated variable names ¹​substrate,\n#   ²​diameter, ³​thickness, ⁴​temp_start, ⁵​temp_end\n```\n:::\n:::\n\n\nYou can see there are multiple retention indexes (`RI`) for each CAS number.\nLet's filter this down some more using some functions from `dplyr` and `stringr`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(stringr)\nRIs_filtered <-\n  RIs %>%\n  filter(gas == \"Helium\",\n         between(length, 20, 30),\n         str_detect(phase, \"5\"),\n         diameter < 0.3,\n         thickness == 0.25) %>% \n  rename(CAS = query)\nhead(RIs_filtered)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 16\n  CAS        RI type  phase length gas   subst…¹ diame…² thick…³ temp_…⁴ temp_…⁵\n  <chr>   <dbl> <chr> <chr>  <dbl> <chr> <chr>     <dbl>   <dbl>   <dbl>   <dbl>\n1 83-34-1 1380  Capi… DB-5…     30 Heli… <NA>       0.25    0.25      35     225\n2 83-34-1 1396  Capi… DB-5…     30 Heli… <NA>       0.25    0.25      35     200\n3 83-34-1 1391  Capi… DB-5      30 Heli… <NA>       0.26    0.25      50     300\n4 119-36… 1201  Capi… DB-5      25 Heli… <NA>       0.25    0.25      60     200\n5 119-36… 1201. Capi… HP-5…     30 Heli… <NA>       0.25    0.25      80     300\n6 119-36… 1190  Capi… HP-5…     30 Heli… <NA>       0.25    0.25      60     280\n# … with 5 more variables: temp_rate <dbl>, hold_start <dbl>, hold_end <dbl>,\n#   reference <chr>, comment <chr>, and abbreviated variable names ¹​substrate,\n#   ²​diameter, ³​thickness, ⁴​temp_start, ⁵​temp_end\n```\n:::\n:::\n\n\nNow we could `summarise` to get an average of all the database entries...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRIs_filtered %>% \n  group_by(CAS) %>% \n  summarise(mean_RI = mean(RI))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n  CAS        mean_RI\n  <chr>        <dbl>\n1 119-36-8     1193.\n2 123-35-3      990.\n3 19700-21-1   1430 \n4 83-34-1      1389 \n```\n:::\n:::\n\n\nOr if we wanted to pick a single entry for each CAS number with the median RI, we could do that as well.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_RIs <-\n  RIs_filtered %>%\n  group_by(CAS) %>% \n  filter(RI == median(RI)) %>% \n  filter(row_number() == 1) %>% \n  select(CAS, RI, reference)\nbest_RIs\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n# Groups:   CAS [4]\n  CAS           RI reference                             \n  <chr>      <dbl> <chr>                                 \n1 83-34-1     1391 Rostad and Pereira, 1986              \n2 119-36-8    1191 Aligiannis, Kalpoutzakis, et al., 2004\n3 123-35-3     991 Maccioni, Baldini, et al., 2007       \n4 19700-21-1  1430 Dickschat, Wenzel, et al., 2004       \n```\n:::\n:::\n\n\nYou could then easily take this table and `*_join()` it to your GC/MS data, if you have a column for CAS#, and select the `RI` and `reference` columns, for example.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(888)\nfake.data <-\n  data.frame(CAS = CASs,\n             #Name = cts_convert(CASs, from = \"CAS\", to = \"Chemical Name\", first = TRUE),\n             Name = c(\"skatole\", \"methyl salicylate\", \"beta-myrcene\", \"geosmin\"),\n             group_1_conc = round(abs(rnorm(4)), 3),\n             group_2_conc = round(abs(rnorm(4)), 3))\n\nleft_join(fake.data, best_RIs) %>%\n  select(CAS, Name, RI, everything()) %>% \n  arrange(RI) %>%\n  knitr::kable()\n```\n\n::: {.cell-output-display}\n|CAS        |Name              |   RI| group_1_conc| group_2_conc|reference                              |\n|:----------|:-----------------|----:|------------:|------------:|:--------------------------------------|\n|123-35-3   |beta-myrcene      |  991|        0.730|        2.166|Maccioni, Baldini, et al., 2007        |\n|119-36-8   |methyl salicylate | 1191|        1.544|        0.251|Aligiannis, Kalpoutzakis, et al., 2004 |\n|83-34-1    |skatole           | 1391|        1.951|        1.656|Rostad and Pereira, 1986               |\n|19700-21-1 |geosmin           | 1430|        0.278|        0.587|Dickschat, Wenzel, et al., 2004        |\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}